{% extends "base.html" %}
{% import "ads.html" as ads %}
{% block content %}
<div class="grid2" id="mainContent">
  {% if live_video %}
    <section class="card live-card" id="liveSection">
      <h2 style="color:red">LIVE NOW</h2>
      <div class="video-player">
        <video src="/uploads/videos/{{ live_video.filename }}" controls autoplay style="width:100%;max-width:640px;"></video>
        <div class="live-title">{{ live_video.title }}</div>
      </div>
    </section>
  {% endif %}
  <section class="card" id="videoSection">
    <!-- Video list will be loaded here -->
    {{ ads.feed_ad(0) }}
  </section>
  <aside class="card" id="serverSection">
    <h3>Servers</h3>
    <div class="scroll" id="serverList">
      <!-- Server list will be loaded here -->
    </div>
    {{ ads.sidebar_ads_widget() }}
  </aside>
</div>
<script>
async function fetchMainContent() {
  const res = await fetch("/api/main-content");
  if (res.ok) {
    const data = await res.json();
    // Update video section
    document.getElementById("videoSection").innerHTML = data.videos_html + document.getElementById("videoSection").innerHTML.split("{{ ads.feed_ad(0) }}")[1];
    // Update server section
    document.getElementById("serverList").innerHTML = data.servers_html;
  }
}
setInterval(fetchMainContent, 10000); // Poll every 10 seconds
window.addEventListener('DOMContentLoaded', fetchMainContent);
</script>
{% endblock %}